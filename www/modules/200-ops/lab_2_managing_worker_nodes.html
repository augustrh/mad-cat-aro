<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Modern App Dev Roadshow - Cloud Architect Track for ARO</title>
    <link rel="prev" href="lab_1_cluster_upgrades.html">
    <link rel="next" href="lab_3_autoscaling.html">
    <meta name="generator" content="Antora 3.1.5">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="../..">Modern App Dev Roadshow - Cloud Architect Track for ARO</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="modules" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html" class=" query-params-link">Modern App Dev Roadshow - Cloud Architect Track for ARO</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../100-setup/lab_1_environment.html">Explore the environment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../100-setup/lab_2_access_cluster.html">Access your ARO cluster</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="lab_1_cluster_upgrades.html">Upgrade your ARO cluster</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="lab_2_managing_worker_nodes.html">Managing Worker Nodes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="lab_3_autoscaling.html">Autoscale your ARO Cluster</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="lab_4_labeling_nodes.html">Labeling your Worker Nodes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="lab_5_observability.html">Configure Red Hat OpenShift Logging with Azure Files</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../300-apps/lab_1_deploy_app.html">Deploy an application with Azure Database</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../300-apps/lab_2_openshift_gitops.html">Deploy an application with Red Hat OpenShift GitOps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../300-apps/lab_3_network_policy.html">Secure your applications with Network Policies</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../300-apps/lab_4_resilient_app.html">Make your application resilient</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../400-service-mesh/lab_1_service_mesh_introduction.html">Service Mesh Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../400-service-mesh/lab_2_service_mesh_deploy_operator.html">Install Service Mesh Operator</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../400-service-mesh/lab_3_service_mesh_deploy_control_plane.html">Deploy Service Mesh Control Plane</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../400-service-mesh/lab_4_service_mesh_deploy_app.html">Deploy a Service Mesh example application</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../400-service-mesh/lab_5_service_mesh_weighted_routing.html">Set up Service Mesh Weighted Routing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../400-service-mesh/lab_6_service_mesh_observe.html">Configure and observe Service Mesh traffic</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../conclusion.html">Conclusion &amp; What&#8217;s Next</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Modern App Dev Roadshow - Cloud Architect Track for ARO</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Modern App Dev Roadshow - Cloud Architect Track for ARO</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Modern App Dev Roadshow - Cloud Architect Track for ARO</a></li>
    <li><a href="lab_2_managing_worker_nodes.html">Managing Worker Nodes</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///antora/content/modules/ROOT/pages/200-ops/lab_2_managing_worker_nodes.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When deploying your ARO cluster, you can configure many aspects of your worker nodes, but what happens when you need to change your worker nodes after they&#8217;ve already been created? These activities include scaling the number of nodes, changing the instance type, adding labels or taints, just to name a few.</p>
</div>
<div class="paragraph">
<p>Many of these changes are done using MachineSets. MachineSets ensure that a specified number of Machine replicas are running at any given time. Think of a MachineSet as a "template" for the kinds of Machines that make up the worker nodes of your cluster. These are similar to other Kubernetes resources, like a ReplicaSet is to Pods. One important caveat, is that MachineSets allow users to manage many Machines as a single entity, but are contained to a specific availability zone. If you&#8217;d like to learn more, see the <a href="https://docs.openshift.com/container-platform/latest/machine_management/index.html" target="_blank" rel="noopener">Red Hat documentation on machine management</a>.</p>
</div>
<div class="paragraph">
<p>Here are some of the advantages of using ARO MachineSets to manage the size of your cluster</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Scalability - MachineSets enables horizontal scaling of your cluster. It can easily add or remove workers to handle the changes in workload. This flexibility ensures that your cluster can dynamically scale to meet the needs of your applications.</p>
</li>
<li>
<p>Infrastructure Diversity - MachineSets allow you to provision worker nodes of different instance type. This enables you to leverage the best kind of instance family for different workloads.</p>
</li>
<li>
<p>Integration with Cluster Autoscaler - MachineSets seamlessly integrate with the Cluster Autoscaler feature, which automatically adjusts the number of worker nodes based on the current demand. This integration ensures efficient resource utilization by scaling the cluster up or down as needed, optimizing costs and performance.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/scale_machinesets.png" alt="scale_machinesets">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scaling_worker_nodes"><a class="anchor" href="#_scaling_worker_nodes"></a>Scaling worker nodes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_via_the_cli"><a class="anchor" href="#_via_the_cli"></a>Via the CLI</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First, let&#8217;s see what MachineSets already exist in our cluster.
To do so, run the following command:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">oc -n openshift-machine-api get machineset</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">NAME                                     DESIRED   CURRENT   READY   AVAILABLE   AGE
aro-cluster-lwqq8-8mkmr-worker-eastus1   1         1         1       1           108m
aro-cluster-lwqq8-8mkmr-worker-eastus2   1         1         1       1           108m
aro-cluster-lwqq8-8mkmr-worker-eastus3   1         1         1       1           108m</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, ARO clusters have three MachineSets, one for each availability zone.</p>
</div>
</li>
<li>
<p>Now, let&#8217;s take a look at the machines that have been created according to the instructions provided by the above MachineSets.
To do so, run the following command:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">oc -n openshift-machine-api get machine</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">NAME                                           PHASE     TYPE              REGION   ZONE   AGE
aro-cluster-lwqq8-8mkmr-master-0               Running   Standard_D8s_v3   eastus   1      107m
aro-cluster-lwqq8-8mkmr-master-1               Running   Standard_D8s_v3   eastus   2      107m
aro-cluster-lwqq8-8mkmr-master-2               Running   Standard_D8s_v3   eastus   3      107m
aro-cluster-lwqq8-8mkmr-worker-eastus1-vgmng   Running   Standard_D4s_v3   eastus   1      102m
aro-cluster-lwqq8-8mkmr-worker-eastus2-m4dgh   Running   Standard_D4s_v3   eastus   2      102m
aro-cluster-lwqq8-8mkmr-worker-eastus3-k65k6   Running   Standard_D4s_v3   eastus   3      102m</code></pre>
</div>
</div>
<div class="paragraph">
<p>For this workshop, we&#8217;ve deployed your ARO cluster with six total machines (three workers machines and three control plane machines), one in each availability zone.</p>
</div>
</li>
<li>
<p>Now that we know that we have three worker nodes, let&#8217;s pick a MachineSet to scale up using the OpenShift CLI tools.
To do so, run the following command:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">MACHINESET=$(oc -n openshift-machine-api get machinesets -o name | head -1)

echo ${MACHINESET}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">machineset.machine.openshift.io/aro-cluster-lwqq8-8mkmr-worker-eastus1</code></pre>
</div>
</div>
</li>
<li>
<p>Now, let&#8217;s scale up our selected MachineSet from one to two machines.
To do so, run the following command:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">oc -n openshift-machine-api scale --replicas=2 ${MACHINESET}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">machineset.machine.openshift.io/aro-cluster-vhtbl-8xd66-worker-westeurope1 scaled</code></pre>
</div>
</div>
</li>
<li>
<p>Now that we&#8217;ve scaled the MachineSet to two machines, we can see that the machine is already being created.
First, let&#8217;s quickly check the output of the same command we ran in step 1:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">oc -n openshift-machine-api get machinesets</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">NAME                                     DESIRED   CURRENT   READY   AVAILABLE   AGE
aro-cluster-lwqq8-8mkmr-worker-eastus1   2         2         1       1           108m
aro-cluster-lwqq8-8mkmr-worker-eastus2   1         1         1       1           108m
aro-cluster-lwqq8-8mkmr-worker-eastus3   1         1         1       1           108m</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note, that the number of <strong>desired</strong> and <strong>current</strong> nodes matches the scale we specified, but only one is <strong>ready</strong> and <strong>available</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can also run the same command we ran in step 2 to see the machine being provisioned:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">oc -n openshift-machine-api get machine</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">NAME                                           PHASE         TYPE              REGION   ZONE   AGE
aro-cluster-lwqq8-8mkmr-master-0               Running       Standard_D8s_v3   eastus   1      108m
aro-cluster-lwqq8-8mkmr-master-1               Running       Standard_D8s_v3   eastus   2      108m
aro-cluster-lwqq8-8mkmr-master-2               Running       Standard_D8s_v3   eastus   3      108m
aro-cluster-lwqq8-8mkmr-worker-eastus1-8vzrw   Provisioned   Standard_D4s_v3   eastus   1      17s
aro-cluster-lwqq8-8mkmr-worker-eastus1-vgmng   Running       Standard_D4s_v3   eastus   1      104m
aro-cluster-lwqq8-8mkmr-worker-eastus2-m4dgh   Running       Standard_D4s_v3   eastus   2      104m
aro-cluster-lwqq8-8mkmr-worker-eastus3-k65k6   Running       Standard_D4s_v3   eastus   3      104m</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_via_the_console"><a class="anchor" href="#_via_the_console"></a>Via the Console</h3>
<div class="paragraph">
<p>Now let&#8217;s scale the cluster back down to a total of 3 worker nodes, but this time, from the web console.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Return to your tab with the OpenShift Web Console.</p>
</li>
<li>
<p>Using the menu on the left Select <strong>Compute</strong> -&gt; <strong>MachineSets</strong>.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/web-console-machineset-sidebar.png" alt="Web Console - Cluster Settings">
</div>
</div>
</li>
<li>
<p>In the overview you will see the same information about the MachineSets that you saw on the command line.
Now, locate the MachineSet which has "2 of 2" machines, and click on the <strong>⋮</strong> icon, then select <em>Edit machine count</em>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It may take up to 5 minutes for the MachineSet to scale to 2 nodes while the underlying machine provisions and becomes ready.
Until this time, the machine count will read "1 of 2".</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/web-console-machinesets-three-dots.png" alt="Web Console - MachineSets Menu">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/web-console-machinesets-edit-count-menu.png" alt="Web Console - MachineSets Count Menu">
</div>
</div>
</li>
<li>
<p>Next, reduce the count from "2" to "1" and click <strong>Save</strong> to save your changes.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/web-console-machinesets-edit-count.png" alt="Web Console - MachineSets Edit Count">
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Congratulations!</strong></p>
</div>
<div class="paragraph">
<p>You&#8217;ve successfully scaled your cluster up and back down to three nodes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here you learned how to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Scale an existing MachineSet up to add more nodes to the cluster</p>
</li>
<li>
<p>Scale your MachineSet down to remove worker nodes from the cluster</p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="lab_1_cluster_upgrades.html" class="query-params-link">Upgrade your ARO cluster</a></span>
  <span class="next"><a href="lab_3_autoscaling.html" class="query-params-link">Autoscale your ARO Cluster</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
