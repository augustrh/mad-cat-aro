<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Modern App Dev Roadshow - Cloud Architect Track for ARO</title>
    <link rel="prev" href="../200-ops/lab_5_observability.html">
    <link rel="next" href="lab_2_openshift_gitops.html">
    <meta name="generator" content="Antora 3.1.5">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="../..">Modern App Dev Roadshow - Cloud Architect Track for ARO</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="modules" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html" class=" query-params-link">Modern App Dev Roadshow - Cloud Architect Track for ARO</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../100-setup/lab_1_environment.html">Explore the environment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../100-setup/lab_2_access_cluster.html">Access your ARO cluster</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../200-ops/lab_1_cluster_upgrades.html">Upgrade your ARO cluster</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../200-ops/lab_2_managing_worker_nodes.html">Managing Worker Nodes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../200-ops/lab_3_autoscaling.html">Autoscale your ARO Cluster</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../200-ops/lab_4_labeling_nodes.html">Labeling your Worker Nodes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../200-ops/lab_5_observability.html">Configure Red Hat OpenShift Logging with Azure Files</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="lab_1_deploy_app.html">Deploy an application with Azure Database</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="lab_2_openshift_gitops.html">Deploy an application with Red Hat OpenShift GitOps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="lab_3_network_policy.html">Secure your applications with Network Policies</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="lab_4_resilient_app.html">Make your application resilient</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../400-service-mesh/lab_1_service_mesh_introduction.html">Service Mesh Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../400-service-mesh/lab_2_service_mesh_deploy_operator.html">Install Service Mesh Operator</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../400-service-mesh/lab_3_service_mesh_deploy_control_plane.html">Deploy Service Mesh Control Plane</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../400-service-mesh/lab_4_service_mesh_deploy_app.html">Deploy a Service Mesh example application</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../400-service-mesh/lab_5_service_mesh_weighted_routing.html">Set up Service Mesh Weighted Routing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../400-service-mesh/lab_6_service_mesh_observe.html">Configure and observe Service Mesh traffic</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../conclusion.html">Conclusion &amp; What&#8217;s Next</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Modern App Dev Roadshow - Cloud Architect Track for ARO</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Modern App Dev Roadshow - Cloud Architect Track for ARO</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Modern App Dev Roadshow - Cloud Architect Track for ARO</a></li>
    <li><a href="lab_1_deploy_app.html">Deploy an application with Azure Database</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///antora/content/modules/ROOT/pages/300-apps/lab_1_deploy_app.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s time for us to put our cluster to work and deploy a workload! We&#8217;re going to build an example Java application, <a href="https://github.com/redhat-mw-demos/microsweeper-quarkus/tree/ARO" target="_blank" rel="noopener">microsweeper</a>, using <a href="https://quarkus.io/" target="_blank" rel="noopener">Quarkus</a> (a Kubernetes-native Java stack) and <a href="https://azure.microsoft.com/en-us/products/postgresql/" target="_blank" rel="noopener">Azure Database for PostgreSQL</a>. After configuring the database, we will use both Quarkus, a Kubernetes-native Java framework optimized for containers, and Source-to-Image (S2I), a toolkit for building container images from source code, to deploy the microsweeper application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_azure_database_for_postgresql_instance"><a class="anchor" href="#_create_azure_database_for_postgresql_instance"></a>Create Azure Database for PostgreSQL instance</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First, let&#8217;s create a namespace (also known as a project in OpenShift).
To do so, run the following command:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">oc new-project microsweeper-ex</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">Now using project "microsweeper-ex" on server "https://api.c90qz1cy.eastus.aroapp.io:6443".

You can add applications to this project with the 'new-app' command. For example, try:

    oc new-app rails-postgresql-example

to build a new example application in Ruby. Or use kubectl to deploy a simple Kubernetes application:

    kubectl create deployment hello-node --image=k8s.gcr.io/e2e-test-images/agnhost:2.33 -- /agnhost serve-hostname</code></pre>
</div>
</div>
</li>
<li>
<p>Create the Azure Database for Postgres server resource.
To do so, run the following command (this command will take ~ 5mins)</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">az postgres server create --resource-group openenv-$GUID \
  --location eastus --sku-name GP_Gen5_2 \
  --name microsweeper-$GUID --storage-size 51200 \
  --admin-user myAdmin --admin-pass {generated_password} \
  --public 0.0.0.0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">Checking the existence of the resource group 'openenv-qsd7p'...
Resource group 'openenv-qsd7p' exists ? : True
Creating postgres Server 'microsweeper-qsd7p' in group 'openenv-qsd7p'...
Your server 'microsweeper-qsd7p' is using sku 'GP_Gen5_2' (Paid Tier). Please refer to https://aka.ms/postgres-pricing  for pricing details
Configuring server firewall rule, 'azure-access', to accept connections from all Azure resources...
Make a note of your password. If you forget, you would have to reset your password with 'az postgres server update -n microsweeper-qsd7p -g openenv-qsd7p -p &lt;new-password&gt;'.
{
  "additionalProperties": {},
  "administratorLogin": "myAdmin",

[...Output omitted...]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For the sake of the workshop we are creating a public database that any host in Azure can connect to.
In a real world scenario you would create a private database and connect to it over a private link service</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Check connectivity to the database.
To do so, run the following command:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">psql \
  "host=microsweeper-$GUID.postgres.database.azure.com port=5432
  dbname=postgres
  user=myAdmin@microsweeper-$GUID.postgres.database.azure.com password={generated_password} sslmode=require" \
  -c "select now();"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">-------------------------------
 2023-04-24 20:44:38.088556+00
(1 row)</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_build_and_deploy_the_microsweeper_app"><a class="anchor" href="#_build_and_deploy_the_microsweeper_app"></a>Build and deploy the Microsweeper app</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we&#8217;ve got an Azure managed PostgreSQL instance up and running, let&#8217;s build and deploy our application.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In order to build the application you will need the Java JDK 17 and the Quarkus CLI installed. Java JDK 17 is already installed on your bastion VM so let&#8217;s install the Quarkus CLI:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl -Ls https://sh.jbang.dev | bash -s - trust add https://repo1.maven.org/maven2/io/quarkus/quarkus-cli/

curl -Ls https://sh.jbang.dev | bash -s - app install --fresh --force quarkus@quarkusio

source $HOME/.bashrc</code></pre>
</div>
</div>
</li>
<li>
<p>Double check the Quarkus CLI version:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">quarkus --version</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">3.6.5</code></pre>
</div>
</div>
</li>
<li>
<p>Now, let&#8217;s clone the application from GitHub to our local bastion VM.
To do so, run the following command:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">cd $HOME

git clone https://github.com/rh-mobb/aro-workshop-app.git</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">Cloning into 'aro-workshop-app'...
remote: Enumerating objects: 152, done.
remote: Counting objects: 100% (16/16), done.
remote: Compressing objects: 100% (14/14), done.
remote: Total 152 (delta 12), reused 2 (delta 2), pack-reused 136
Receiving objects: 100% (152/152), 6.57 MiB | 31.29 MiB/s, done.
Resolving deltas: 100% (55/55), done.</code></pre>
</div>
</div>
</li>
<li>
<p>Next, let&#8217;s change directory into the newly cloned Git repository.
To do so, run the following command:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">cd $HOME/aro-workshop-app</code></pre>
</div>
</div>
</li>
<li>
<p>Next, we will add the OpenShift extension to the Quarkus CLI.
To do so, run the following command:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">quarkus ext add openshift</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">Looking for the newly published extensions in registry.quarkus.io
[SUCCESS] ✅  Extension io.quarkus:quarkus-openshift has been installed</code></pre>
</div>
</div>
</li>
<li>
<p>We also want Quarkus to be able to use OpenShift ConfigMaps and Secrets:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">quarkus ext add kubernetes-config</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">Looking for the newly published extensions in registry.quarkus.io
[SUCCESS] ✅  Extension io.quarkus:quarkus-openshift has been installed</code></pre>
</div>
</div>
</li>
<li>
<p>Create a OpenShift secret containing Database credentials for Quarkus to use:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">cat << EOF | oc apply -f -
---
apiVersion: v1
kind: Secret
metadata:
  name: microsweeper-secret
  namespace: microsweeper-ex
type: Opaque
stringData:
  PG_URL: jdbc:postgresql://microsweeper-$GUID.postgres.database.azure.com:5432/postgres
  PG_USER: myAdmin@microsweeper-$GUID.postgres.database.azure.com
  PG_PASS: {generated_password}
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">secret/microsweeper-secret created</code></pre>
</div>
</div>
</li>
<li>
<p>Now, we&#8217;ll configure Quarkus to use the PostgreSQL database that we created earlier in this section.
To do so, we&#8217;ll create an <code>application.properties</code> file to use by running the following command:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">cat &lt;&lt;"EOF" &gt; $HOME/aro-workshop-app/src/main/resources/application.properties
# Database configurations
%prod.quarkus.datasource.db-kind=postgresql
%prod.quarkus.datasource.jdbc.url=${PG_URL}
%prod.quarkus.datasource.username=${PG_USER}
%prod.quarkus.datasource.password=${PG_PASS}
%prod.quarkus.datasource.jdbc.driver=org.postgresql.Driver
%prod.quarkus.hibernate-orm.database.generation=drop-and-create
%prod.quarkus.hibernate-orm.database.generation=update

# OpenShift configurations
%prod.quarkus.kubernetes-client.trust-certs=true
%prod.quarkus.kubernetes.deploy=true
%prod.quarkus.kubernetes.deployment-target=openshift
%prod.quarkus.openshift.build-strategy=docker
%prod.quarkus.openshift.expose=true
%prod.quarkus.openshift.deployment-kind=Deployment
%prod.quarkus.container-image.group=microsweeper-ex
%prod.quarkus.openshift.env.secrets=microsweeper-secret
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>Now that we&#8217;ve provided the proper configuration, we will build our application.
We&#8217;ll do this using <a href="https://github.com/openshift/source-to-image" target="_blank" rel="noopener">source-to-image</a>, a tool built-in to OpenShift.
To start the build and deploy, run the following command:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">quarkus build --no-tests</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">[INFO] Scanning for projects...
Downloading from central: https://repo.maven.apache.org/maven2/io/quarkus/platform/quarkus-maven-plugin/2.11.2.Final/quarkus-maven-plugin-2.11.2.Final.pom
Downloaded from central: https://repo.maven.apache.org/maven2/io/quarkus/platform/quarkus-maven-plugin/2.11.2.Final/quarkus-maven-plugin-2.11.2.Final.pom (6.9 kB at 11 kB/s)

[...Output omitted...]

[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  02:41 min
[INFO] Finished at: 2023-04-24T20:58:59Z
[INFO] ------------------------------------------------------------------------</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Quarkus will build the .jar locally and then work with the OpenShift build system to inject it into a Red Hat UBI image, save that to the built in OpenShift registry, and then run the resulting image in OpenShift.</p>
</div>
</div>
</div>
</li>
<li>
<p>We want to see custom metrics from the Quarkus app (they&#8217;re exposed by the Quarkus micrometer plugin) so we can configure a Prometheus <code>ServiceMonitor</code> resource to watch for the applications label.</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">cat &lt;&lt; EOF | oc apply -f -
---
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  labels:
    k8s-app: microsweeper-monitor
  name: microsweeper-monitor
  namespace: microsweeper-ex
spec:
  endpoints:
  - interval: 30s
    targetPort: 8080
    path: /q/metrics
    scheme: http
  selector:
    matchLabels:
      app.kubernetes.io/name: microsweeper-appservice
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">servicemonitor.monitoring.coreos.com/microsweeper-monitor created</code></pre>
</div>
</div>
</li>
<li>
<p>Change back to your previous working directory</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">cd $HOME</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_review"><a class="anchor" href="#_review"></a>Review</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s take a look at what this command did, along with everything that was created in your cluster.
Return to your tab with the OpenShift Web Console.</p>
</div>
<div class="sect2">
<h3 id="_container_images"><a class="anchor" href="#_container_images"></a>Container Images</h3>
<div class="paragraph">
<p>From the Administrator perspective, expand <em>Builds</em> and then <em>ImageStreams</em>, and select the <em>microsweeper-ex</em> project.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/web-console-imagestreams.png" alt="OpenShift Web Console - Imagestreams">
</div>
</div>
<div class="paragraph">
<p>You will see two images that were created on your behalf when you ran the quarkus build command.
There is one image for <code>openjdk-11</code> that comes with OpenShift as a Universal Base Image (UBI) that the application will run under.
With UBI, you get highly optimized and secure container images that you can build your applications with.
For more information on UBI please read this <a href="https://www.redhat.com/en/blog/introducing-red-hat-universal-base-image" target="_blank" rel="noopener">article</a>.</p>
</div>
<div class="paragraph">
<p>The second image you see is the the <code>microsweeper-appservice</code> image.
This is the image for the application that was built automatically for you and pushed to the built-in container registry inside of OpenShift.</p>
</div>
</div>
<div class="sect2">
<h3 id="_image_build"><a class="anchor" href="#_image_build"></a>Image Build</h3>
<div class="paragraph">
<p>How did those images get built you ask?
Back on the OpenShift Web Console, click on <em>BuildConfigs</em> and then the <em>microsweeper-appservice</em> entry.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/web-console-buildconfigs.png" alt="OpenShift Web Console - BuildConfigs">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/web-console-microsweeper-appservice-buildconfig.png" alt="OpenShift Web Console - microsweeper-appservice BuildConfig">
</div>
</div>
<div class="paragraph">
<p>When you ran the <code>quarkus build</code> command, this created the BuildConfig you can see here.
In our quarkus settings, we set the deployment strategy to build the image using Docker.
The Dockerfile file from the git repo that we cloned was used for this BuildConfig.</p>
</div>
<div class="paragraph">
<p>A build configuration describes a single build definition and a set of triggers for when a new build is created.
Build configurations are defined by a BuildConfig, which is a REST object that can be used in a POST to the API server to create a new instance.</p>
</div>
<div class="paragraph">
<p>You can read more about BuildConfigs <a href="https://docs.openshift.com/container-platform/latest/cicd/builds/understanding-buildconfigs.html" target="_blank" rel="noopener">here</a>.</p>
</div>
<div class="paragraph">
<p>Once the BuildConfig was created, the source-to-image process kicked off a Build of that BuildConfig.
The build is what actually does the work in building and deploying the image.
We started with defining what to be built with the BuildConfig and then actually did the work with the Build.</p>
</div>
<div class="paragraph">
<p>You can read more about Builds <a href="https://docs.openshift.com/container-platform/latest/cicd/builds/understanding-image-builds.html" target="_blank" rel="noopener">here</a>.</p>
</div>
<div class="paragraph">
<p>To look at what the build actually did, click on Builds tab and then into the first Build in the list.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/web-console-builds.png" alt="OpenShift Web Console - Builds">
</div>
</div>
<div class="paragraph">
<p>On the next screen, explore around.
Look specifically at the YAML definition of the build and the logs to see what the build actually did.
If you build failed for some reason, the logs are a great first place to start to look at to debug what happened.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/web-console-build-logs.png" alt="OpenShift Web Console - Build Logs">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_image_deployment"><a class="anchor" href="#_image_deployment"></a>Image Deployment</h3>
<div class="paragraph">
<p>After the image was built, the source-to-image process then deployed the application for us.
In the quarkus properties file, we specified that a deployment should be created.
You can view the deployment under <em>Workloads</em> -&gt; <em>Deployments</em>, and then click on the Deployment name.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/web-console-deployments.png" alt="OpenShift Web Console - Deployments">
</div>
</div>
<div class="paragraph">
<p>Explore around the deployment screen, check out the different tabs, look at the YAML that was created.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/web-console-deployment-yaml.png" alt="OpenShift Web Console - Deployment YAML">
</div>
</div>
<div class="paragraph">
<p>Look at the pod the deployment created, and see that it is running.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/web-console-deployment-pods.png" alt="OpenShift Web Console - Deployment Pods">
</div>
</div>
<div class="paragraph">
<p>The last thing we will look at is the route that was created for our application.
In the quarkus properties file, we specified that the application should be exposed to the Internet.
When you create a Route, you have the option to specify a hostname.
To start with, we will just use the default domain that comes with ARO (<code>useast.aroapp.io</code> in our case).
In the next section, we will expose the same application to a custom domain leveraging Azure Front Door.</p>
</div>
<div class="paragraph">
<p>You can read more about routes in the <a href="https://docs.openshift.com/container-platform/latest/networking/routes/route-configuration.html" target="_blank" rel="noopener">Red Hat documentation</a>.</p>
</div>
<div class="paragraph">
<p>From the OpenShift Web Console menu, click on <em>Networking</em>-&gt;<em>Routes</em>, and the <em>microsweeper-appservice</em> route.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/web-console-routes.png" alt="OpenShift Web Console - Routes">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_test_the_application"><a class="anchor" href="#_test_the_application"></a>Test the application</h3>
<div class="paragraph">
<p>While in the route section of the OpenShift Web Console, click the URL under <em>Location</em>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/web-console-route-link.png" alt="OpenShift Web Console - Route Link">
</div>
</div>
<div class="paragraph">
<p>You can also get the the URL for your application using the command line:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">oc get route microsweeper-appservice -n microsweeper-ex -o jsonpath='{"http://"}{.spec.host}{"\n"}'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">http://microsweeper-appservice-microsweeper-ex.apps.nbybk9f3.eastus.aroapp.io/</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is an <code>http</code> route - some browsers automatically convert <code>http</code> to <code>https</code> which means the application will appear unavailable.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_view_custom_metrics_for_the_app"><a class="anchor" href="#_view_custom_metrics_for_the_app"></a>View custom metrics for the App</h3>
<div class="paragraph">
<p>Switch the OpenShift Web Console to the Developer view, select the project <code>microsweeper-ex</code> and go to <span class="menuseq"><b class="menu">Observe</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Metrics</b></span> and type <code>process_uptime_seconds</code> into custom metrics.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/custom-metrics.png" alt="OpenShift Web Console - Custom Metrics">
</div>
</div>
<div class="paragraph">
<p>Switch the timeframe to <code>5min</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/custom-metrics-timeframe.png" alt="OpenShift Web Console - Custom Metrics Timeframe">
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>While you&#8217;re here, expore the other available dashboards to learn more about your project&#8217;s metrics.</p>
</div>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/custom-metrics-projects.png" alt="OpenShift Web Console - Custom Metrics Timeframe">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here you learned how to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create Azure Database for PostgreSQL instance.</p>
</li>
<li>
<p>Build and deploy the Microsweeper app.</p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="../200-ops/lab_5_observability.html" class="query-params-link">Configure Red Hat OpenShift Logging with Azure Files</a></span>
  <span class="next"><a href="lab_2_openshift_gitops.html" class="query-params-link">Deploy an application with Red Hat OpenShift GitOps</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
