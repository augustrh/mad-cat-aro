<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Modern App Dev Roadshow - Cloud Architect Track for ARO</title>
    <link rel="prev" href="../100-setup/lab_2_access_cluster.html">
    <link rel="next" href="lab_2_managing_worker_nodes.html">
    <meta name="generator" content="Antora 3.1.5">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="../..">Modern App Dev Roadshow - Cloud Architect Track for ARO</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="modules" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html" class=" query-params-link">Modern App Dev Roadshow - Cloud Architect Track for ARO</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../100-setup/lab_1_environment.html">Explore the environment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../100-setup/lab_2_access_cluster.html">Access your ARO cluster</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="lab_1_cluster_upgrades.html">Upgrade your ARO cluster</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="lab_2_managing_worker_nodes.html">Managing Worker Nodes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="lab_3_autoscaling.html">Autoscale your ARO Cluster</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="lab_4_labeling_nodes.html">Labeling your Worker Nodes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="lab_5_observability.html">Configure Red Hat OpenShift Logging with Azure Files</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../300-apps/lab_1_deploy_app.html">Deploy an application with Azure Database</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../300-apps/lab_2_openshift_gitops.html">Deploy an application with Red Hat OpenShift GitOps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../300-apps/lab_3_network_policy.html">Secure your applications with Network Policies</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../300-apps/lab_4_resilient_app.html">Make your application resilient</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../400-service-mesh/lab_1_service_mesh_introduction.html">Service Mesh Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../400-service-mesh/lab_2_service_mesh_deploy_operator.html">Install Service Mesh Operator</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../400-service-mesh/lab_3_service_mesh_deploy_control_plane.html">Deploy Service Mesh Control Plane</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../400-service-mesh/lab_4_service_mesh_deploy_app.html">Deploy a Service Mesh example application</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../400-service-mesh/lab_5_service_mesh_weighted_routing.html">Set up Service Mesh Weighted Routing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../400-service-mesh/lab_6_service_mesh_observe.html">Configure and observe Service Mesh traffic</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../conclusion.html">Conclusion &amp; What&#8217;s Next</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Modern App Dev Roadshow - Cloud Architect Track for ARO</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Modern App Dev Roadshow - Cloud Architect Track for ARO</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Modern App Dev Roadshow - Cloud Architect Track for ARO</a></li>
    <li><a href="lab_1_cluster_upgrades.html">Upgrade your ARO cluster</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///antora/content/modules/ROOT/pages/200-ops/lab_1_cluster_upgrades.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Azure Red Hat OpenShift (ARO) provides fully-managed cluster upgrades. These upgrades can be triggered from inside the OpenShift Web Console, or scheduled in advance by utilizing the Managed Upgrade Operator. The ARO Site Reliability Engineering (SRE) Team will monitor and manage all ARO cluster upgrades.</p>
</div>
<div class="paragraph">
<p>During ARO upgrades, one node is upgraded at a time. This is done to ensure customer applications are not impacted during the update, when deployed in a highly-available and fault-tolerant method.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_upgrade_using_the_openshift_web_console"><a class="anchor" href="#_upgrade_using_the_openshift_web_console"></a>Upgrade using the OpenShift Web Console</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Return to your tab with the OpenShift Web Console.</p>
</li>
<li>
<p>Using the menu on the left Select <strong>Administration</strong> -&gt; <strong>Cluster Settings</strong>.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/web-console-cluster-settings.png" alt="Web Console - Cluster Settings">
</div>
</div>
</li>
<li>
<p>Click on the <strong>Not Configured</strong> link under the <strong>Upgrade Channel</strong> heading.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/web-console-upgrade-channel-not-configured.png" alt="Web Console - Upgrade Channel Not Configured">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Upgrade channel is not configured by default</p>
</div>
<div class="paragraph">
<p>By default, the <a href="https://docs.openshift.com/container-platform/4.13/updating/understanding-upgrade-channels-release.html" target="_blank" rel="noopener">upgrade channel</a> (which is used to recommend the appropriate release versions for cluster updates), is not set in ARO.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>In the <strong>Channel</strong> field, enter <code>stable-4.13</code> to set the upgrade channel to the stable releases of OpenShift 4.13 and click <strong>Save</strong>.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/web-console-input-channel.png" alt="Web Console - Input Channel">
</div>
</div>
</li>
<li>
<p>In a moment, you&#8217;ll begin to see what upgrades are available for your cluster.
From here, you could click the <strong>Select a version</strong> button and upgrade the cluster. But don&#8217;t do that yet! Instead, follow the instructions below to use the Managed Upgrade Operator.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Again, do not perform an upgrade at this stage!</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_upgrade_using_the_managed_upgrade_operator"><a class="anchor" href="#_upgrade_using_the_managed_upgrade_operator"></a>Upgrade using the Managed Upgrade Operator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Managed Upgrade Operator has been created to manage the orchestration of automated in-place cluster upgrades.</p>
</div>
<div class="paragraph">
<p>Whilst the operator&#8217;s job is to invoke a cluster upgrade, it does not perform any activities of the cluster upgrade process itself.</p>
</div>
<div class="paragraph">
<p>This remains the responsibility of OpenShift.</p>
</div>
<div class="paragraph">
<p>The operator&#8217;s goal is to satisfy the operating conditions that a managed cluster must hold, both pre- and post-invocation of the cluster upgrade.</p>
</div>
<div class="paragraph">
<p>Examples of activities that are not core to an OpenShift upgrade process but could be handled by the operator include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pre- and post-upgrade health checks.</p>
</li>
<li>
<p>Providing additional worker capacity during the upgrade period to ensure you have sufficient capacity when nodes are updated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Configuring the Managed Upgrade Operator for ARO ensures that your cluster functions as you need it to during upgrades.
The process of executing upgrades is shown here:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/upgradecluster-flow.svg" alt="MUO Upgrade Process Flow Chart">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First, let&#8217;s check for available upgrades on your current upgrade channel.
To do so, run the following command:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">oc get clusterversion version -o \
  jsonpath='{.status.availableUpdates[*].version}'; echo</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">4.13.24</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the output of the command is <code>parse error: Invalid numeric literal at EOF at line 1, column 5</code> you may not have set the <code>stable-4.13</code> channel as instructed earlier, or there are no available upgrades and you should skip the rest of these steps.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Next, let&#8217;s use that information to populate a manifest for the Managed Upgrade Operator to use.
To do so, run the following command:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">OCP_UPGRADE_TO=$(oc get clusterversion version -o \
   jsonpath='{.status.availableUpdates[0].version}')

cat &lt;&lt;EOF | oc apply -f -
---
apiVersion: upgrade.managed.openshift.io/v1alpha1
kind: UpgradeConfig
metadata:
  name: managed-upgrade-config
  namespace: openshift-managed-upgrade-operator
spec:
  type: "ARO"
  upgradeAt: $(date -u --iso-8601=seconds --date "+1 day")
  PDBForceDrainTimeout: 60
  capacityReservation: true
  desired:
    channel: "stable-4.13"
    version: "${OCP_UPGRADE_TO}"
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">upgradeconfig.upgrade.managed.openshift.io/managed-upgrade-config created</code></pre>
</div>
</div>
<div class="paragraph">
<p>This manifest will schedule an upgrade to the latest available version available in the <code>stable-4.13</code> channel for 1 day from now, allow nodes which are blocked by PodDisruptionBudgets to drain for 60 minutes before a drain is forced, and sets a capacity reservation so that workloads are not interrupted during an upgrade.</p>
</div>
</li>
<li>
<p>Once created, we can see that the update is pending by running the following command:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">oc -n openshift-managed-upgrade-operator get \
  upgradeconfig.upgrade.managed.openshift.io/managed-upgrade-config</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-text hljs" data-lang="text">NAME                     DESIRED_VERSION   PHASE     STAGE   STATUS   REASON   MESSAGE
managed-upgrade-config   4.13.24           Pending</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Congratulations!</strong></p>
</div>
<div class="paragraph">
<p>You&#8217;ve successfully scheduled an upgrade of your cluster for tomorrow at this time.
While the workshop environment will be deleted before then, you now have the experience to schedule upgrades in the future.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_resources"><a class="anchor" href="#_additional_resources"></a>Additional Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_red_hat_openshift_upgrade_graph_tool"><a class="anchor" href="#_red_hat_openshift_upgrade_graph_tool"></a>Red Hat OpenShift Upgrade Graph Tool</h3>
<div class="paragraph">
<p>Occasionally, you may be not be able to go directly from your current version to a desired version. In these cases, you must first upgrade your cluster from your current version, to an intermediary version, and then to your desired version. To help you navigate these decisions, you can take advantage of the <a href="https://access.redhat.com/labs/ocpupgradegraph/update_path" target="_blank" rel="noopener">Red Hat OpenShift Upgrade Graph Tool</a>. Please note: you&#8217;ll need your Red Hat login to access this tool.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/aro_upgrade_graph.png" alt="ARO Upgrade Graph Tool Screenshot">
</div>
</div>
<div class="paragraph">
<p>In this scenario to upgrade your cluster from version 4.11.0 to 4.12.15, you must first upgrade to 4.11.39, then you can upgrade to 4.12.15. The ARO Upgrade Graph Tool helps you easily see which version you should upgrade to.</p>
</div>
</div>
<div class="sect2">
<h3 id="_links_to_documentation"><a class="anchor" href="#_links_to_documentation"></a>Links to Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure/openshift/howto-upgrade" target="_blank" rel="noopener">Upgrade an Azure Red Hat OpenShift cluster</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure/openshift/howto-upgrade#scheduling-individual-upgrades-using-the-managed-upgrade-operator" target="_blank" rel="noopener">Scheduling individual upgrades using the managed-upgrade-operator</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/4.13/updating/understanding_updates/intro-to-updates.html#update-service-about_understanding-openshift-updates" target="_blank" rel="noopener">About the OpenShift Update Service</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h3>
<div class="paragraph">
<p>Here you learned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All upgrades are monitored and managed by the ARO SRE Team</p>
</li>
<li>
<p>How to use the OpenShift Web Console or the Managed Upgrade Operator to schedule an upgrade for your ARO cluster</p>
</li>
<li>
<p>How to explore the OpenShift Upgrade Graph Tool to see available upgrade paths</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="../100-setup/lab_2_access_cluster.html" class="query-params-link">Access your ARO cluster</a></span>
  <span class="next"><a href="lab_2_managing_worker_nodes.html" class="query-params-link">Managing Worker Nodes</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
